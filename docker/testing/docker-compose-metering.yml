version: '3'
services:
  metering-service:
    image: hyc-odm-docker.artifactory.swg-devops.com/metering-service:8.10.5.0-amd64
    ports:
    - 9999:9999
    healthcheck:
      test: ["CMD", "curl", "-f", "https://metering-service:9999","-k"]
      interval: 1m30s
      timeout: 10s
      retries: 3
      start_period: 40s
    environment:
      - METERING_LOGGINGLEVEL=DEBUG
      - METERING_PROCESSINGRATE=6000
      - METERING_PROCESSING_INITIAL_DELAY=6000
  

  dbserver:
    image: $REPOSITORY/dbserver:$ODMVERSION

    ports:
    - 5432:5432
    environment:
      - POSTGRESQL_USER=odmusr
      - POSTGRESQL_PASSWORD=odmpwd
      - POSTGRESQ_DB=odmdb
      - PGDATA=/var/lib/postgresql/data
      - SAMPLE=true
# Uncomment this line to persist your data. Note that on OSX you need to share this
# current directory in the Preference menu -> File Sharing menu.
#    volumes:
#      - ./pgdata:/pgdata

  odm-decisionserverconsole:
    image: $REPOSITORY/odm-decisionserverconsole:$ODMVERSION
    environment:
      - COM_IBM_RULES_METERING_ENABLE=TRUE
      - METERING_SERVER_URL=https://metering-service:9999
      - METERING_SEND_PERIOD=10000
    links:
    - dbserver
    depends_on:
    - dbserver
    ports:
    - 9080:9080
    - 1883:1883
    - 9843:9443
#    volumes:
#    - ./plugin-configuration.properties:/config/baiemitterconfig/plugin-configuration.properties

  odm-decisioncenter:
    image: $REPOSITORY/odm-decisioncenter:$ODMVERSION
    environment:
      - COM_IBM_RULES_METERING_ENABLE=TRUE
      - METERING_SERVER_URL=https://metering-service:9999
      - METERING_SEND_PERIOD=10000
    links:
    - dbserver
    depends_on:
    - dbserver
    ports:
    - 9060:9060
    - 9643:9453
#    volumes:
#    - ./plugin-configuration.properties:/config/baiemitterconfig/plugin-configuration.properties  
